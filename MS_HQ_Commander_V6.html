<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>M-SECURITY | HQ æŒ‡æ®ä¸­å¿ƒ V6.0</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --hq-blue: #00a9e0; --hq-bg: #04090f; --panel-bg: #0c141d; --text: #eceff1; }
        body { background: var(--hq-bg); color: var(--text); font-family: "Microsoft JhengHei", sans-serif; margin: 0; padding: 20px; }
        
        .dashboard-header { border-bottom: 2px solid var(--hq-blue); padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        .grid-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        
        .panel { background: var(--panel-bg); border: 1px solid #1e2d3d; border-radius: 4px; padding: 15px; margin-bottom: 20px; }
        .panel-title { color: var(--hq-blue); font-size: 14px; font-weight: bold; border-left: 4px solid var(--hq-blue); padding-left: 10px; margin-bottom: 15px; text-transform: uppercase; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; background: #151f2b; color: var(--hq-blue); padding: 10px; border-bottom: 2px solid #04090f; }
        td { padding: 10px; border-bottom: 1px solid #1c2631; }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .tag { padding: 2px 8px; border-radius: 2px; font-size: 11px; font-weight: bold; }
        .tag-query { background: #37474f; color: #fff; }
        .tag-bio { background: #ffb400; color: #000; } /* ç”Ÿç‰©è¾¨è­˜ */
        .tag-doc { background: #00e676; color: #000; } /* è­‰ä»¶æƒæ */
        .tag-emergency { background: #d50032; color: #fff; animation: flash 1s infinite; }

        /* K9 å€å¡Š */
        .k9-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
        .k9-card { background: #16212e; padding: 10px; text-align: center; border: 1px solid #263238; }
        .k9-name { display: block; font-weight: bold; margin-bottom: 5px; }
        .k9-status { font-size: 11px; color: #8899a6; }

        @keyframes flash { 50% { opacity: 0.5; } }
        .scroll { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>

    <div class="dashboard-header">
        <div>
            <h1 style="margin:0; font-size:24px;">M-SECURITY ç¸½éƒ¨çµ‚ç«¯ç³»çµ±</h1>
            <div style="font-size:12px; color: #546e7a;">æ“ä½œå“¡: å°é»‘å“¥ | æ¬Šé™ç­‰ç´š: LEVEL-MAX</div>
        </div>
        <div style="text-align:right;">
            <div id="clock" style="font-size:20px; font-weight:bold; font-family:monospace;">00:00:00</div>
            <div style="font-size:11px; color: #00ff00;">â— ç³»çµ±è¡›æ˜Ÿé€£ç·šæ­£å¸¸</div>
        </div>
    </div>

    <div class="grid-layout">
        <div class="main-content">
            <div class="panel">
                <div class="panel-title">ğŸ“¡ å…¨åŸŸè¡Œç‚ºè¿½è¹¤ (åŒ…å«æŒ‡ç´‹èˆ‡è­‰ä»¶æƒæ)</div>
                <div class="scroll">
                    <table>
                        <thead>
                            <tr><th>æ™‚é–“</th><th>æ“ä½œå“¡</th><th>è¡Œç‚ºé¡åˆ¥</th><th>æŸ¥è©¢å…§å®¹/ç‹€æ…‹</th></tr>
                        </thead>
                        <tbody id="searchLogs"></tbody>
                    </table>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">ğŸ“‘ å‹¤å‹™ä»£ç¢¼ç´€éŒ„ (10-CODES)</div>
                <div class="scroll">
                    <table>
                        <thead>
                            <tr><th>ä»£ç¢¼</th><th>å‹¤å‹™æè¿°</th><th>å›å ±æ™‚é–“</th></tr>
                        </thead>
                        <tbody id="dispatchLogs"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="panel">
                <div class="panel-title">ğŸ• K9 æˆ°è¡“çµ„ç‹€æ…‹</div>
                <div class="k9-grid">
                    <div class="k9-card"><span class="k9-name">å¸ƒä¸</span><span class="k9-status" id="k9-å¸ƒä¸">--</span></div>
                    <div class="k9-card"><span class="k9-name">å°ç™½</span><span class="k9-status" id="k9-å°ç™½">--</span></div>
                    <div class="k9-card"><span class="k9-name">å°èŠ±</span><span class="k9-status" id="k9-å°èŠ±">--</span></div>
                    <div class="k9-card"><span class="k9-name">æœ‰éŒ¢</span><span class="k9-status" id="k9-æœ‰éŒ¢">--</span></div>
                </div>
                <div style="margin-top:15px; font-size:11px; color:var(--hq-blue);">â€» è³‡æ–™ä¾†æºï¼šç¾å ´çµ‚ç«¯å›å ±</div>
            </div>

            <div class="panel">
                <div class="panel-title">ğŸ‘¤ å¿«é€Ÿå“¡å·¥ç®¡ç†</div>
                <input type="text" id="eID" placeholder="å·¥è™Ÿ" style="width:100%; margin-bottom:5px; background:#000; color:#fff; border:1px solid #333; padding:8px;">
                <input type="text" id="eName" placeholder="å§“å" style="width:100%; margin-bottom:5px; background:#000; color:#fff; border:1px solid #333; padding:8px;">
                <button onclick="upEmp()" style="width:100%; background:var(--hq-blue); border:none; padding:10px; font-weight:bold;">åŒæ­¥æ•¸æ“šåº«</button>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ç›£æ§å…¨åŸŸè¡Œç‚º
    db.ref('search_logs').limitToLast(20).on('value', s => {
        const b = document.getElementById('searchLogs'); b.innerHTML = '';
        if(s.val()) {
            Object.values(s.val()).reverse().forEach(log => {
                let tagClass = 'tag-query', tagText = 'è³‡æ–™æŸ¥è©¢';
                if(log.query.includes('FINGERPRINT')) { tagClass = 'tag-bio'; tagText = 'ç”Ÿç‰©è¾¨è­˜'; }
                if(log.query.includes('DOC_SCAN')) { tagClass = 'tag-doc'; tagText = 'è­‰ä»¶æƒæ'; }
                
                b.innerHTML += `<tr>
                    <td>${log.time.split(' ')[1]}</td>
                    <td>${log.user}</td>
                    <td><span class="tag ${tagClass}">${tagText}</span></td>
                    <td>${log.query}</td>
                </tr>`;
            });
        }
    });

    // ç›£æ§å‹¤å‹™ä»£ç¢¼
    db.ref('reactLogs').limitToLast(10).on('value', s => {
        const b = document.getElementById('dispatchLogs'); b.innerHTML = '';
        if(s.val()) {
            Object.values(s.val()).reverse().forEach(log => {
                const emg = log.code === '10-99' ? 'tag-emergency' : '';
                b.innerHTML += `<tr>
                    <td><span class="tag ${emg}">${log.code}</span></td>
                    <td>${log.note}</td>
                    <td>${log.time}</td>
                </tr>`;
            });
        }
    });

    // ç›£æ§ K9
    const k9s = ['å¸ƒä¸', 'å°ç™½', 'å°èŠ±', 'æœ‰éŒ¢'];
    k9s.forEach(name => {
        db.ref('k9Logs/' + name).limitToLast(1).on('value', s => {
            if(s.val()) {
                const last = Object.values(s.val())[0];
                document.getElementById('k9-' + name).innerText = last.note.substring(0,6) + '..';
            }
        });
    });

    function upEmp() {
        const id = document.getElementById('eID').value, name = document.getElementById('eName').value;
        if(!id || !name) return alert("è«‹è¼¸å…¥è³‡æ–™");
        db.ref('employee_list/' + id).set({ id, name, dept: "HQ-ADDED", plate: "" });
        alert("å“¡å·¥ " + name + " å·²åŒæ­¥è‡³å…¨ç³»çµ±");
    }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
