<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Police çµ‚æ¥µæŒ‡æ®çœ‹æ¿</title>
    <style>
        :root {
            --p-blue: #00e5ff;
            --p-bg: #050505;
            --card-bg: #151515;
            --glass: rgba(255, 255, 255, 0.05);
        }
        body {
            margin: 0;
            background: var(--p-bg);
            color: white;
            font-family: "Microsoft JhengHei", sans-serif;
            height: 100vh;
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 20px;
            padding: 25px;
            box-sizing: border-box;
        }

        /* å·¦å´ï¼šå¤§å­—å‹¤å‹™å€ */
        .main-panel {
            background: var(--card-bg);
            border-radius: 40px;
            border-left: 12px solid var(--p-blue);
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
        }
        .main-panel::before {
            content: "OPERATIONAL STATUS";
            position: absolute;
            top: 40px;
            left: 60px;
            color: #444;
            letter-spacing: 8px;
            font-size: 0.9rem;
        }
        #dutyText {
            font-size: 5.5rem;
            font-weight: 900;
            margin: 0;
            text-shadow: 0 0 30px rgba(0, 229, 255, 0.3);
        }
        .update-info {
            margin-top: 40px;
            color: #666;
            font-size: 1.2rem;
            font-family: monospace;
        }

        /* å³å´ï¼šè³‡è¨Šåˆ— */
        .side-panel {
            display: grid;
            grid-template-rows: 1.2fr 1fr;
            gap: 20px;
        }
        .info-card {
            background: var(--card-bg);
            border-radius: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            border: 1px solid #222;
        }

        /* æ™‚é˜æ¨£å¼ */
        #clock { font-size: 4.5rem; font-weight: bold; color: var(--p-blue); text-shadow: 0 0 20px rgba(0, 229, 255, 0.5); }
        #date-lunar { font-size: 1.4rem; color: #aaa; margin-top: 15px; letter-spacing: 2px; }

        /* å¤©æ°£æ¨£å¼ */
        .weather-icon { font-size: 5rem; margin-bottom: 15px; }
        #weatherTemp { font-size: 2.5rem; font-weight: bold; }
        #weatherDesc { color: #888; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="main-panel">
        <div id="dutyText">ç³»çµ±é€£ç·šä¸­...</div>
        <div class="update-info">LAST SYNC: <span id="syncTime">--:--:--</span></div>
    </div>

    <div class="side-panel">
        <div class="info-card">
            <div id="clock">00:00:00</div>
            <div id="date-lunar">è¼‰å…¥æ—¥æœŸä¸­...</div>
        </div>
        <div class="info-card">
            <div class="weather-icon" id="w-icon">â˜€ï¸</div>
            <div id="weatherTemp">å°ä¸­ --Â°C</div>
            <div id="weatherDesc">åµæ¸¬å¤©æ°£ä¸­...</div>
        </div>
    </div>

    <script>
        const FIREBASE_URL = 'https://factor-security-d1965-default-rtdb.firebaseio.com/dutyLogs.json';

        // 1. æ™‚é–“èˆ‡è¾²æ›† (ç°¡åŒ–ç‰ˆè¾²æ›†é¡¯ç¤º)
        function updateTime() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('zh-TW', { hour12: false });
            
            // æ ¼å¼ï¼š2026-02-26 æ˜ŸæœŸå››
            const options = { year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'long' };
            document.getElementById('date-lunar').innerText = now.toLocaleDateString('zh-TW', options).replace(/\//g, '-');
        }

        // 2. æŠ“å– Firebase è³‡æ–™
        async function syncFirebase() {
            try {
                const res = await fetch(FIREBASE_URL);
                const data = await res.json();
                if (data) {
                    document.getElementById('dutyText').innerText = data.text;
                    document.getElementById('syncTime').innerText = data.time || "Just Now";
                }
            } catch (e) { console.error("Firebase é€£ç·šå¤±æ•—"); }
        }

        // 3. æŠ“å–å³æ™‚å¤©æ°£ (ä½¿ç”¨ Open-Meteo å…è²» API)
        async function syncWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=24.15&longitude=120.68&current_weather=true');
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                
                document.getElementById('weatherTemp').innerText = `å°ä¸­ ${temp}Â°C`;
                
                // æ ¹æ“šå¤©æ°£ä»£ç¢¼è®Šæ›´åœ–ç¤º
                let icon = "â˜€ï¸";
                let desc = "æ™´æœ—";
                if (code > 0) { icon = "â›…"; desc = "å¤šé›²"; }
                if (code > 50) { icon = "ğŸŒ§ï¸"; desc = "æœ‰é›¨"; }
                
                document.getElementById('w-icon').innerText = icon;
                document.getElementById('weatherDesc').innerText = `ç›®å‰ç‹€æ…‹ï¼š${desc}`;
            } catch (e) { console.error("å¤©æ°£åŒæ­¥å¤±æ•—"); }
        }

        // è¨­å®šåŸ·è¡Œé »ç‡
        setInterval(updateTime, 1000);      // æ¯ç§’æ›´æ–°æ™‚é–“
        setInterval(syncFirebase, 2000);   // æ¯ 2 ç§’åŒæ­¥ Firebase (é›²ç«¯ç›¸é€š)
        setInterval(syncWeather, 1800000); // æ¯ 30 åˆ†é˜æ›´æ–°å¤©æ°£

        // åˆå§‹åŸ·è¡Œä¸€æ¬¡
        updateTime();
        syncFirebase();
        syncWeather();
    </script>
</body>
</html>
