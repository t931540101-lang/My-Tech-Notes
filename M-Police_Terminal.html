<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Police å‹¤å‹™ç³»çµ±</title>
    <style>
        :root { --p-blue: #1a5c9f; --p-dark: #333; --p-light: #e3f2fd; }
        body { margin: 0; font-family: sans-serif; background: #f0f0f0; padding-bottom: 80px; }
        .header { background: var(--p-blue); color: white; padding: 15px; text-align: center; font-size: 1.2rem; font-weight: bold; position: sticky; top: 0; z-index: 100; }
        .section-title { background: var(--p-dark); color: white; padding: 10px 15px; font-size: 0.9rem; }
        .page { display: none; padding: 15px; background: white; min-height: 85vh; }
        .form-group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--p-blue); border-left: 4px solid var(--p-blue); padding-left: 8px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .btn-submit { background: var(--p-blue); color: white; border: none; width: 100%; padding: 16px; font-size: 1.1rem; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #loginPage { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: var(--p-blue); color: white; padding: 20px; box-sizing: border-box; }
        .login-box { background: white; padding: 30px; border-radius: 10px; width: 100%; max-width: 300px; color: #333; }
        .menu-item { background: var(--p-light); border-bottom: 1px solid #ccc; padding: 20px; text-align: center; color: #333; text-decoration: none; display: block; font-weight: 600; }
        .footer { position: fixed; bottom: 0; width: 100%; background: var(--p-blue); display: none; }
        .nav-item { flex: 1; color: white; padding: 15px 5px; text-align: center; font-size: 0.85rem; cursor: pointer; border-right: 1px solid rgba(255,255,255,0.2); }
    </style>
</head>
<body>

<div id="loginPage">
    <div style="margin-bottom: 20px; font-size: 1.5rem; font-weight: bold;">M-Police å‹¤å‹™ç™»å…¥</div>
    <div class="login-box">
        <div class="form-group"><label>å¸³è™Ÿ (å§“å)</label><input type="text" id="loginUser" placeholder="å°é»‘å“¥"></div>
        <div class="form-group"><label>å¯†ç¢¼ (å·¥è™Ÿ)</label><input type="password" id="loginPass" placeholder="1030701"></div>
        <button class="btn-submit" style="width:100%" onclick="checkLogin()">æˆæ¬Šç™»å…¥</button>
    </div>
</div>

<div id="appContent" style="display:none;">
    <div class="header" id="pageTitle">è­¦å¯Ÿ SOP æŸ¥è©¢ APP</div>
    <div id="mainMenu">
        <div class="section-title">æ¥­å‹™åˆ†é¡æŸ¥è©¢</div>
        <div class="menu-item" onclick="showPage('admin', 'è¡Œæ”¿é¡ - å…¬å‹™è³‡è¨Š')">è¡Œæ”¿é¡ (äº¤æ¥çœ‹æ¿)</div>
        <div class="menu-item" onclick="showPage('transport', 'äº¤é€šé¡')">äº¤é€šé¡</div>
        <div class="menu-item" onclick="showPage('security', 'ä¿å®‰é¡')">ä¿å®‰é¡</div>
    </div>

    <div id="page-admin" class="page">
        <div class="form-group"><label>äº¤æ¥äº‹é …çœ‹æ¿å…§å®¹</label><textarea id="adminMemo" rows="5" placeholder="è¼¸å…¥è¦é¡¯ç¤ºåœ¨æ¡Œé¢çœ‹æ¿çš„æ–‡å­—..."></textarea></div>
        <button class="btn-submit" onclick="saveAndSync('è¡Œæ”¿', 'adminMemo')">åŒæ­¥è‡³ Google é›²ç«¯</button>
    </div>

    <div id="page-transport" class="page">
        <label>è»Šç‰Œè™Ÿç¢¼</label><input type="text" id="carId"><button class="btn-submit" onclick="saveAndSync('äº¤é€š', 'carId')">åŒæ­¥å­˜æª”</button>
    </div>

    <div id="page-security" class="page">
        <label>å·¡é‚å€åŸŸ</label><textarea id="secNote" rows="3"></textarea><button class="btn-submit" onclick="saveAndSync('ä¿å®‰', 'secNote')">åŒæ­¥å­˜æª”</button>
    </div>

    <div class="footer" id="mainFooter">
        <div class="nav-item" onclick="goHome()">å›é¦–é </div>
        <div class="nav-item" onclick="location.reload()">ç™»å‡º</div>
    </div>
</div>

<script>
    // æ›æˆä½ çš„ Firebase ç¶²å€ï¼Œè¨˜å¾—å¾Œé¢åŠ  /dutyLogs.json
const FIREBASE_URL = 'https://factor-security-d1965-default-rtdb.firebaseio.com/dutyLogs.json';

async function saveAndSync(cat, inputId) {
    const text = document.getElementById(inputId).value;
    const now = new Date().toLocaleString();
    const data = { 
        text: text, 
        time: now,
        sender: "å°é»‘å“¥"
    };

    try {
        // Firebase ç”¨ PUT æˆ– POST å°±èƒ½ç›´æ¥å¯«å…¥ï¼Œä¸éœ€è¦ Google é‚£æ¨£ç¹ç‘£çš„éƒ¨ç½²
        await fetch(FIREBASE_URL, {
            method: 'PUT', // PUT æœƒè¦†è“‹èˆŠçš„ï¼Œé©åˆåªé¡¯ç¤ºæœ€æ–°ä¸€ç­†çš„çœ‹æ¿
            body: JSON.stringify(data)
        });
        alert('ğŸš€ Firebase åŒæ­¥æˆåŠŸï¼');
    } catch (err) {
        alert('âŒ åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯');
    }
}

    function showPage(pId, title) {
        document.getElementById('mainMenu').style.display = 'none';
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.getElementById('page-' + pId).style.display = 'block';
        document.getElementById('pageTitle').innerText = title;
    }

    function goHome() {
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.getElementById('mainMenu').style.display = 'block';
        document.getElementById('pageTitle').innerText = 'è­¦å¯Ÿ SOP æŸ¥è©¢ APP';
    }

    async function saveAndSync(cat, inputId) {
        const text = document.getElementById(inputId).value;
        const now = new Date().toLocaleString();
        const data = { text: text, level: "ä¸€èˆ¬", sender: "å°é»‘å“¥", time: now };

        try {
            await fetch(GOOGLE_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            alert('âœ… é›²ç«¯åŒæ­¥æŒ‡ä»¤å·²ç™¼é€ï¼');
        } catch (err) { console.log(err); }
        goHome();
    }
</script>
</body>
</html>
