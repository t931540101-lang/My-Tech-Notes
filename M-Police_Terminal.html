<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Police å‹¤å‹™ç³»çµ±</title>
    <style>
        :root { --p-blue: #1a5c9f; --p-dark: #333; --p-light: #e3f2fd; --p-danger: #d9534f; --p-warn: #fff3cd; }
        body { margin: 0; font-family: sans-serif; background: #f0f0f0; padding-bottom: 80px; }
        .header { background: var(--p-blue); color: white; padding: 15px; text-align: center; font-size: 1.2rem; font-weight: bold; position: sticky; top: 0; z-index: 100; }
        .section-title { background: var(--p-dark); color: white; padding: 10px 15px; font-size: 0.9rem; }
        .page { display: none; padding: 15px; background: white; min-height: 85vh; }
        .form-group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--p-blue); border-left: 4px solid var(--p-blue); padding-left: 8px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .btn-submit { background: var(--p-blue); color: white; border: none; width: 100%; padding: 16px; font-size: 1.1rem; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* ç™»å…¥é  */
        #loginPage { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: var(--p-blue); color: white; padding: 20px; box-sizing: border-box; }
        .login-box { background: white; padding: 30px; border-radius: 10px; width: 100%; max-width: 300px; color: #333; }
        .menu-item { background: var(--p-light); border-bottom: 1px solid #ccc; padding: 20px; text-align: center; color: #333; text-decoration: none; display: block; font-weight: 600; }
        .footer { position: fixed; bottom: 0; width: 100%; background: var(--p-blue); display: none; }
        .nav-item { flex: 1; color: white; padding: 15px 5px; text-align: center; font-size: 0.85rem; cursor: pointer; border-right: 1px solid rgba(255,255,255,0.2); }
    </style>
</head>
<body>

<div id="loginPage">
    <div style="margin-bottom: 20px; font-size: 1.5rem; font-weight: bold;">M-Police å‹¤å‹™ç™»å…¥</div>
    <div class="login-box">
        <div class="form-group"><label>å¸³è™Ÿ (å§“å)</label><input type="text" id="loginUser" placeholder="å°é»‘å“¥"></div>
        <div class="form-group"><label>å¯†ç¢¼ (å·¥è™Ÿ)</label><input type="password" id="loginPass" placeholder="1030701"></div>
        <button class="btn-submit" style="width:100%" onclick="checkLogin()">æˆæ¬Šç™»å…¥</button>
    </div>
</div>

<div id="appContent" style="display:none;">
    <div class="header" id="pageTitle">è­¦å¯Ÿ SOP æŸ¥è©¢ APP</div>

    <div id="mainMenu">
        <div class="section-title">æ¥­å‹™åˆ†é¡æŸ¥è©¢</div>
        <div class="menu-item" onclick="showPage('transport', 'äº¤é€šé¡ - å‹¤å‹™ç™»è¨˜')">äº¤é€šé¡</div>
        <div class="menu-item" onclick="showPage('security', 'ä¿å®‰é¡ - å·¡é‚ç´€éŒ„')">ä¿å®‰é¡</div>
        <div class="menu-item" onclick="showPage('admin', 'è¡Œæ”¿é¡ - å…¬å‹™è³‡è¨Š')">è¡Œæ”¿é¡</div>
        <div class="menu-item" onclick="showPage('it', 'å¾Œå‹¤é¡ - æŠ€è¡“ç¶­è­·')">å¾Œå‹¤é¡</div>
        <div class="menu-item" onclick="showPage('emergency', 'å‹¤å‹™æŒ‡æ® - ç·Šæ€¥æ‡‰è®Š')">å‹¤å‹™æŒ‡æ®</div>
    </div>

    <div id="page-transport" class="page">
        <div class="form-group"><label>è»Šç‰Œè™Ÿç¢¼</label><input type="text" id="carId" placeholder="ABC-1234"></div>
        <div class="form-group"><label>é¡å‹</label><select id="carType"><option>å¤–ä¾†å¤§è²¨è»Š</option><option>è¨ªå®¢è»Šè¼›</option></select></div>
        <button class="btn-submit" onclick="saveAndSync('äº¤é€š', 'carId', 'carType')">åŒæ­¥ä¸¦å„²å­˜</button>
    </div>

    <div id="page-security" class="page">
        <div class="form-group"><label>å·¡é‚å€åŸŸ</label><select id="secArea"><option>å·¥å» å¤§é–€</option><option>å€‰åº«</option><option>é…é›»å®¤</option></select></div>
        <div class="form-group"><label>æè¿°</label><textarea id="secNote" rows="3">ä¸€åˆ‡æ­£å¸¸</textarea></div>
        <button class="btn-submit" onclick="saveAndSync('ä¿å®‰', 'secNote', 'secArea')">åŒæ­¥ä¸¦å„²å­˜</button>
    </div>

    <div id="page-admin" class="page">
        <div class="form-group"><label>ä¸Šç­æ™‚æ®µ</label><input type="text" value="07:00 ~ 19:00" readonly></div>
        <div class="form-group"><label>äº¤æ¥äº‹é …çœ‹æ¿å…§å®¹</label><textarea id="adminMemo" rows="5" placeholder="è¼¸å…¥è¦é¡¯ç¤ºåœ¨æ¡Œé¢çœ‹æ¿çš„æ–‡å­—..."></textarea></div>
        <button class="btn-submit" onclick="saveAndSync('è¡Œæ”¿', 'adminMemo')">åŒæ­¥è‡³é›²ç«¯çœ‹æ¿</button>
    </div>

    <div id="page-it" class="page">
        <div style="background:#fff3cd; padding:10px; border-radius:5px; margin-bottom:15px; font-size:0.8rem;">ã€ä»»å‹™å­˜æª”ã€‘HP 15s SSD è¨ˆç•«å·²é€€ä¼‘ã€‚</div>
        <div class="form-group"><label>æŠ€è¡“å¿ƒå¾—</label><textarea id="itNote" rows="3"></textarea></div>
        <button class="btn-submit" onclick="saveAndSync('å¾Œå‹¤', 'itNote')">å„²å­˜æŠ€è¡“è³‡æ–™</button>
    </div>

    <div id="page-emergency" class="page">
        <div class="form-group"><label>ç·Šæ€¥ç¨‹åº¦</label><select id="emLvl"><option>ğŸ”´ ç·Šæ€¥</option><option>ğŸ”µ ä¸€èˆ¬</option></select></div>
        <button class="btn-submit" style="background:var(--p-danger);" onclick="saveAndSync('ç·Šæ€¥', 'emLvl')">ç™¼é€ç·Šæ€¥é€šå ±</button>
    </div>

    <div class="footer" id="mainFooter">
        <div class="nav-item" onclick="goHome()">å›é¦–é </div>
        <div class="nav-item" onclick="showLogs()">æ­·å²</div>
        <div class="nav-item" onclick="location.reload()">ç™»å‡º</div>
    </div>
</div>

<script>
    // --- é›²ç«¯è¨­å®šå€ ---
    const GITHUB_TOKEN = 'è²¼ä¸Šä½ çš„_ghp_å¯†é‘°'; 
    const REPO_OWNER = 't931540101-lang';
    const REPO_NAME = 'My-Tech-Notes';
    const FILE_PATH = 'handover_data.json';

    // 1. ç™»å…¥æª¢æŸ¥
    function checkLogin() {
        const u = document.getElementById('loginUser').value;
        const p = document.getElementById('loginPass').value;
        if(u === "å°é»‘å“¥" && p === "1030701") {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContent').style.display = 'block';
            document.getElementById('mainFooter').style.display = 'flex';
        } else { alert('å¸³å¯†éŒ¯èª¤'); }
    }

    // 2. é é¢åˆ‡æ›
    function showPage(pageId, title) {
        document.getElementById('mainMenu').style.display = 'none';
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.getElementById('page-' + pageId).style.display = 'block';
        document.getElementById('pageTitle').innerText = title;
    }

    function goHome() {
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.getElementById('mainMenu').style.display = 'block';
        document.getElementById('pageTitle').innerText = 'è­¦å¯Ÿ SOP æŸ¥è©¢ APP';
    }

    // 3. é›²ç«¯åŒæ­¥ + æœ¬æ©Ÿå­˜æª”
    async function saveAndSync(category, inputId, extraId = null) {
        const text = document.getElementById(inputId).value;
        const level = extraId ? document.getElementById(extraId).value : "ä¸€èˆ¬";
        const now = new Date().toLocaleString();

        // A. æœ¬æ©Ÿå­˜æª” (LocalStorage)
        let logs = JSON.parse(localStorage.getItem('PoliceLogs') || '[]');
        logs.push({ cat: category, time: now, content: text });
        localStorage.setItem('PoliceLogs', JSON.stringify(logs));

        // B. é›²ç«¯åŒæ­¥ (GitHub API)
        const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
        try {
            const getRes = await fetch(url + '?t=' + new Date().getTime());
            const fileData = await getRes.json();
            const sha = fileData.sha;

            const newContent = { text: text, sender: "å°é»‘å“¥", level: level, time: now };
            const putRes = await fetch(url, {
                method: 'PUT',
                headers: { 'Authorization': `token ${GITHUB_TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: `Update ${now}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(newContent, null, 2)))),
                    sha: sha
                })
            });

            if (putRes.ok) alert('âœ… é›²ç«¯èˆ‡æœ¬æ©ŸåŒæ­¥æˆåŠŸï¼');
            else alert('âŒ é›²ç«¯æ›´æ–°å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Tokenã€‚');
        } catch (err) { alert('é€£ç·šç•°å¸¸ï¼š' + err); }
        goHome();
    }

    function showLogs() {
        let logs = JSON.parse(localStorage.getItem('PoliceLogs') || '[]');
        if(logs.length === 0) return alert('å°šç„¡ç´€éŒ„');
        alert('æœ€è¿‘æ“ä½œï¼š' + logs[logs.length-1].cat + ' @ ' + logs[logs.length-1].time);
    }
</script>
</body>
</html>
